{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\\\uC774\\uC9C0\\uC6D0\\\\Desktop\\\\LeeJiWon\\\\2025\\\\\\uB3D9\\uC591\\uBBF8\\uB798\\uB300\\uD559\\uAD50\\\\aStareDown\\\\a-stare-down\\\\src\\\\components\\\\main\\\\ViewCamera.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst EYE_LEFT = [263, 249, 390, 373, 374, 380];\nconst EYE_RIGHT = [33, 7, 163, 144, 145, 153];\nfunction calculateEAR(landmarks, eyeIndices) {\n  const [p1, p2, p3, p4, p5, p6] = eyeIndices.map(i => landmarks[i]);\n  const vertical1 = Math.hypot(p2.x - p6.x, p2.y - p6.y);\n  const vertical2 = Math.hypot(p3.x - p5.x, p3.y - p5.y);\n  const horizontal = Math.hypot(p1.x - p4.x, p1.y - p4.y);\n  return (vertical1 + vertical2) / (2 * horizontal);\n}\nconst ViewCamera = () => {\n  _s();\n  const videoRef = useRef(null);\n  const [blinkCount, setBlinkCount] = useState(0);\n  const [ear, setEar] = useState(0);\n  const isInitialized = useRef(false);\n  useEffect(() => {\n    let faceMesh;\n    const script = document.createElement(\"script\");\n    const initialize = async () => {\n      // 1. SIMD 비활성화 버전 로드\n      script.src = \"https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js\";\n      document.head.appendChild(script);\n      await new Promise(resolve => {\n        script.onload = resolve;\n      });\n\n      // 2. WASM 파일 경로 강제 설정\n      window.Module = {\n        locateFile: path => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${path.replace(\"_simd.wasm\", \".wasm\")}`\n      };\n\n      // 3. FaceMesh 초기화\n      faceMesh = new window.FaceMesh({\n        locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`\n      });\n      faceMesh.setOptions({\n        maxNumFaces: 1,\n        selfieMode: true,\n        minDetectionConfidence: 0.5,\n        minTrackingConfidence: 0.5\n      });\n      faceMesh.onResults(results => {\n        var _results$multiFaceLan;\n        if ((_results$multiFaceLan = results.multiFaceLandmarks) !== null && _results$multiFaceLan !== void 0 && _results$multiFaceLan[0]) {\n          const landmarks = results.multiFaceLandmarks[0];\n          const avgEAR = (calculateEAR(landmarks, EYE_LEFT) + calculateEAR(landmarks, EYE_RIGHT)) / 2;\n          setEar(avgEAR);\n          if (avgEAR < 0.25) setBlinkCount(p => p + 1);\n        }\n      });\n\n      // 4. 프레임 처리 루프\n      const processFrame = async () => {\n        var _videoRef$current;\n        if (((_videoRef$current = videoRef.current) === null || _videoRef$current === void 0 ? void 0 : _videoRef$current.readyState) === 4) {\n          await faceMesh.send({\n            image: videoRef.current\n          });\n        }\n        requestAnimationFrame(processFrame);\n      };\n      processFrame();\n      isInitialized.current = true;\n    };\n    initialize().catch(console.error);\n    return () => {\n      if (faceMesh) faceMesh.close();\n      document.head.removeChild(script);\n    };\n  }, []);\n\n  // 웹캠 초기화\n  useEffect(() => {\n    if (!isInitialized.current) return;\n    navigator.mediaDevices.getUserMedia({\n      video: {\n        width: 640,\n        height: 480\n      }\n    }).then(stream => {\n      videoRef.current.srcObject = stream;\n    });\n  }, [isInitialized.current]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      position: \"relative\",\n      width: 640,\n      margin: \"auto\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"video\", {\n      ref: videoRef,\n      autoPlay: true,\n      playsInline: true,\n      style: {\n        transform: \"scaleX(-1)\",\n        width: \"100%\"\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: \"absolute\",\n        top: 20,\n        left: 20,\n        color: \"white\",\n        backgroundColor: \"rgba(0,0,0,0.5)\",\n        padding: 10\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [\"Blinks: \", blinkCount]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [\"EAR: \", ear.toFixed(3)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 101,\n    columnNumber: 5\n  }, this);\n};\n_s(ViewCamera, \"K2XQfizX1R9Kz6D4eWxq85xqUfM=\");\n_c = ViewCamera;\nexport default ViewCamera;\nvar _c;\n$RefreshReg$(_c, \"ViewCamera\");","map":{"version":3,"names":["React","useEffect","useRef","useState","jsxDEV","_jsxDEV","EYE_LEFT","EYE_RIGHT","calculateEAR","landmarks","eyeIndices","p1","p2","p3","p4","p5","p6","map","i","vertical1","Math","hypot","x","y","vertical2","horizontal","ViewCamera","_s","videoRef","blinkCount","setBlinkCount","ear","setEar","isInitialized","faceMesh","script","document","createElement","initialize","src","head","appendChild","Promise","resolve","onload","window","Module","locateFile","path","replace","FaceMesh","file","setOptions","maxNumFaces","selfieMode","minDetectionConfidence","minTrackingConfidence","onResults","results","_results$multiFaceLan","multiFaceLandmarks","avgEAR","p","processFrame","_videoRef$current","current","readyState","send","image","requestAnimationFrame","catch","console","error","close","removeChild","navigator","mediaDevices","getUserMedia","video","width","height","then","stream","srcObject","style","position","margin","children","ref","autoPlay","playsInline","transform","fileName","_jsxFileName","lineNumber","columnNumber","top","left","color","backgroundColor","padding","toFixed","_c","$RefreshReg$"],"sources":["C:/Users/이지원/Desktop/LeeJiWon/2025/동양미래대학교/aStareDown/a-stare-down/src/components/main/ViewCamera.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\n\r\nconst EYE_LEFT = [263, 249, 390, 373, 374, 380];\r\nconst EYE_RIGHT = [33, 7, 163, 144, 145, 153];\r\n\r\nfunction calculateEAR(landmarks, eyeIndices) {\r\n  const [p1, p2, p3, p4, p5, p6] = eyeIndices.map((i) => landmarks[i]);\r\n  const vertical1 = Math.hypot(p2.x - p6.x, p2.y - p6.y);\r\n  const vertical2 = Math.hypot(p3.x - p5.x, p3.y - p5.y);\r\n  const horizontal = Math.hypot(p1.x - p4.x, p1.y - p4.y);\r\n  return (vertical1 + vertical2) / (2 * horizontal);\r\n}\r\n\r\nconst ViewCamera = () => {\r\n  const videoRef = useRef(null);\r\n  const [blinkCount, setBlinkCount] = useState(0);\r\n  const [ear, setEar] = useState(0);\r\n  const isInitialized = useRef(false);\r\n\r\n  useEffect(() => {\r\n    let faceMesh;\r\n    const script = document.createElement(\"script\");\r\n\r\n    const initialize = async () => {\r\n      // 1. SIMD 비활성화 버전 로드\r\n      script.src =\r\n        \"https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js\";\r\n      document.head.appendChild(script);\r\n\r\n      await new Promise((resolve) => {\r\n        script.onload = resolve;\r\n      });\r\n\r\n      // 2. WASM 파일 경로 강제 설정\r\n      window.Module = {\r\n        locateFile: (path) =>\r\n          `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${path.replace(\r\n            \"_simd.wasm\",\r\n            \".wasm\"\r\n          )}`,\r\n      };\r\n\r\n      // 3. FaceMesh 초기화\r\n      faceMesh = new window.FaceMesh({\r\n        locateFile: (file) =>\r\n          `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`,\r\n      });\r\n\r\n      faceMesh.setOptions({\r\n        maxNumFaces: 1,\r\n        selfieMode: true,\r\n        minDetectionConfidence: 0.5,\r\n        minTrackingConfidence: 0.5,\r\n      });\r\n\r\n      faceMesh.onResults((results) => {\r\n        if (results.multiFaceLandmarks?.[0]) {\r\n          const landmarks = results.multiFaceLandmarks[0];\r\n          const avgEAR =\r\n            (calculateEAR(landmarks, EYE_LEFT) +\r\n              calculateEAR(landmarks, EYE_RIGHT)) /\r\n            2;\r\n          setEar(avgEAR);\r\n          if (avgEAR < 0.25) setBlinkCount((p) => p + 1);\r\n        }\r\n      });\r\n\r\n      // 4. 프레임 처리 루프\r\n      const processFrame = async () => {\r\n        if (videoRef.current?.readyState === 4) {\r\n          await faceMesh.send({ image: videoRef.current });\r\n        }\r\n        requestAnimationFrame(processFrame);\r\n      };\r\n      processFrame();\r\n      isInitialized.current = true;\r\n    };\r\n\r\n    initialize().catch(console.error);\r\n\r\n    return () => {\r\n      if (faceMesh) faceMesh.close();\r\n      document.head.removeChild(script);\r\n    };\r\n  }, []);\r\n\r\n  // 웹캠 초기화\r\n  useEffect(() => {\r\n    if (!isInitialized.current) return;\r\n\r\n    navigator.mediaDevices\r\n      .getUserMedia({\r\n        video: { width: 640, height: 480 },\r\n      })\r\n      .then((stream) => {\r\n        videoRef.current.srcObject = stream;\r\n      });\r\n  }, [isInitialized.current]);\r\n\r\n  return (\r\n    <div style={{ position: \"relative\", width: 640, margin: \"auto\" }}>\r\n      <video\r\n        ref={videoRef}\r\n        autoPlay\r\n        playsInline\r\n        style={{ transform: \"scaleX(-1)\", width: \"100%\" }}\r\n      />\r\n      <div\r\n        style={{\r\n          position: \"absolute\",\r\n          top: 20,\r\n          left: 20,\r\n          color: \"white\",\r\n          backgroundColor: \"rgba(0,0,0,0.5)\",\r\n          padding: 10,\r\n        }}\r\n      >\r\n        <div>Blinks: {blinkCount}</div>\r\n        <div>EAR: {ear.toFixed(3)}</div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ViewCamera;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}